<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SunGrid</title>
    <!-- Load Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Cartoon Fonts: Luckiest Guy for titles, Nunito for body -->
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Setting the cartoon fonts */
        body {
            font-family: 'Nunito', sans-serif;
            /* Light, cheerful background */
            background: #F0F9FF; /* Light Sky Blue */
            color: #1F2937; /* Dark Gray text */
            line-height: 1.5;
        }
        h1, h2 {
            font-family: 'Luckiest Guy', cursive;
        }
        /* Custom scrollbar for a touch of fun */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #F87171; /* Bright Red */
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #EF4444; /* Darker Red */
        }
        
        /* Loading animation for analysis - Bouncy effect */
        .dot-pulse {
            display: inline-flex;
            gap: 6px;
            align-items: center;
        }
        .dot-pulse span {
            /* Make the text slightly animated too */
            animation: text-pulse 1.5s infinite ease-in-out;
            font-weight: 700;
        }
        .dot-pulse::before,
        .dot-pulse::after,
        .dot {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
            /* Vibrant Yellow for contrast */
            background-color: #FACC15; 
            animation: bouncy 1.2s infinite ease-in-out;
        }
        .dot-pulse::before {
            animation-delay: -0.4s;
        }
        .dot-pulse::after {
            animation-delay: -0.2s;
        }
        @keyframes bouncy {
            0%, 100% { transform: translateY(0); opacity: 1; }
            50% { transform: translateY(-8px) scale(1.1); opacity: 0.8; }
        }
        @keyframes text-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* Card styles with a comic-book border effect */
        .comic-card {
            border: 4px solid #1F2937; /* Dark border */
            border-radius: 16px;
            transition: all 0.2s ease-out;
            box-shadow: 8px 8px 0px #F87171; /* Colorful offset shadow */
            background-color: white;
        }
        .comic-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 10px 10px 0px #EF4444; 
        }

        /* Button style */
        .comic-button {
            border: 3px solid #1F2937;
            box-shadow: 4px 4px 0px #1F2937;
            transition: all 0.1s ease-out;
        }
        .comic-button:active {
            transform: translate(3px, 3px);
            box-shadow: 0px 0px 0px #1F2937;
        }

    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-6xl mx-auto">
        
        <!-- Header Section: Original Professional Content -->
        <header class="mb-10 pb-4 border-b-4 border-gray-700">
            <!-- Title: SunGrid (Styled with cartoon font) -->
            <h1 class="text-6xl sm:text-7xl font-extrabold text-[#FF6384] mb-2 flex items-center gap-4 animate-bounce-slow">
                SunGrid!
            </h1>
            <!-- Subtitle: Manage and analyze solar energy potential (Styled with cartoon font) -->
            <h2 class="text-3xl font-bold text-gray-800">Manage and analyze solar energy potential</h2>
            <p class="text-gray-600 mt-2 text-base max-w-3xl">
                SunGrid uses XGBoost and practical AI analysis to provide clear, dependable solar irradiance forecasts. Built for energy management, it translates real weather data and proven machine learning into actionable operational insights.
            </p>
            <p class="mt-3 text-sm text-gray-500">
                View the project on <a href="https://github.com/ShardulJagdhane26/SUN-GRID" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">GitHub</a>.
            </p>
        </header>

        <main class="grid lg:grid-cols-2 gap-8">
            
            <!-- COLUMN 1: Inputs and FEATURE IMPORTANCE -->
            <div class="flex flex-col gap-8">

                <!-- 1. Weather Inputs Card: Original Content -->
                <section class="comic-card p-6" aria-labelledby="inputs-heading">
                    <h2 id="inputs-heading" class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-gray-300 pb-2">Weather Inputs</h2>
                    <form id="predict-form">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <!-- Input fields with original labels -->
                            <div>
                                <label for="temperature" class="block text-sm font-bold text-gray-700 mb-1">Temperature (¬∞F)</label>
                                <input id="temperature" type="number" step="0.1" required value="75" class="w-full p-3 border-2 border-gray-400 rounded-xl bg-yellow-50 focus:ring-pink-500 focus:border-pink-500 text-gray-800 shadow-inner">
                            </div>
                            <div>
                                <label for="pressure" class="block text-sm font-bold text-gray-700 mb-1">Pressure (inHg)</label>
                                <input id="pressure" type="number" step="0.01" required value="30.15" class="w-full p-3 border-2 border-gray-400 rounded-xl bg-yellow-50 focus:ring-pink-500 focus:border-pink-500 text-gray-800 shadow-inner">
                            </div>
                            <div>
                                <label for="humidity" class="block text-sm font-bold text-gray-700 mb-1">Humidity (%)</label>
                                <input id="humidity" type="number" step="0.1" required value="50" class="w-full p-3 border-2 border-gray-400 rounded-xl bg-yellow-50 focus:ring-pink-500 focus:border-pink-500 text-gray-800 shadow-inner">
                            </div>
                            <div>
                                <label for="windSpeed" class="block text-sm font-bold text-gray-700 mb-1">Wind Speed (mph)</label>
                                <input id="windSpeed" type="number" step="0.1" required value="5" class="w-full p-3 border-2 border-gray-400 rounded-xl bg-yellow-50 focus:ring-pink-500 focus:border-pink-500 text-gray-800 shadow-inner">
                            </div>
                            <div class="sm:col-span-2">
                                <label for="windDirection" class="block text-sm font-bold text-gray-700 mb-1">Wind Direction (¬∞)</label>
                                <input id="windDirection" type="number" step="1" required value="180" class="w-full p-3 border-2 border-gray-400 rounded-xl bg-yellow-50 focus:ring-pink-500 focus:border-pink-500 text-gray-800 shadow-inner">
                            </div>
                        </div>
                        
                        <div class="flex justify-center items-center mt-8">
                            <button type="submit" class="comic-button px-10 py-4 bg-[#FFD700] text-gray-900 text-xl font-extrabold rounded-2xl hover:bg-[#FFC300] focus:outline-none focus:ring-4 focus:ring-pink-500 focus:ring-offset-2 focus:ring-offset-blue-50">
                                Run Prediction
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-4 text-center">
                            Date/time features auto-calculated.
                        </p>
                    </form>
                </section>

                <!-- 4. Feature Importance Table: Original Content -->
                <section class="comic-card p-6 overflow-x-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-gray-300 pb-2">üîç Feature Importance</h2>
                    <p class="text-base text-gray-600 mb-4">
                        Features ranked by predictive power. Higher scores indicate greater influence on solar irradiance predictions.
                    </p>
                    <table class="w-full text-left text-base text-gray-700 border-collapse">
                        <thead class="bg-[#87CEEB] text-white uppercase text-sm">
                            <tr>
                                <th scope="col" class="px-3 py-3 rounded-tl-xl border-r-2 border-gray-800">#</th>
                                <th scope="col" class="px-6 py-3 border-r-2 border-gray-800">Feature Name</th>
                                <th scope="col" class="px-6 py-3 text-right rounded-tr-xl">Importance Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            <!-- Rows with vibrant colors and bold text (Content remains the same) -->
                            <tr class="border-b-2 border-gray-300 bg-red-100 hover:bg-red-200">
                                <td class="px-3 py-3 text-center w-10 text-2xl text-red-600 font-extrabold">1</td>
                                <td class="px-6 py-3 font-bold">Month</td>
                                <td class="px-6 py-3 text-right text-xl text-red-600 font-extrabold">4684.58</td>
                            </tr>
                            <tr class="border-b-2 border-gray-300 bg-orange-100 hover:bg-orange-200">
                                <td class="px-3 py-3 text-center w-10 text-2xl text-orange-600 font-extrabold">2</td>
                                <td class="px-6 py-3 font-bold">Wind Direction</td>
                                <td class="px-6 py-3 text-right text-xl text-orange-600 font-extrabold">3271.83</td>
                            </tr>
                            <tr class="border-b-2 border-gray-300 bg-yellow-100 hover:bg-yellow-200">
                                <td class="px-3 py-3 text-center w-10 text-2xl text-yellow-600 font-extrabold">3</td>
                                <td class="px-6 py-3 font-bold">Day</td>
                                <td class="px-6 py-3 text-right text-xl text-yellow-600 font-extrabold">2841.93</td>
                            </tr>
                            <tr class="border-b-2 border-gray-300 bg-green-100 hover:bg-green-200">
                                <td class="px-3 py-3 text-center w-10 text-2xl text-green-600 font-extrabold">4</td>
                                <td class="px-6 py-3 font-bold">Temperature</td>
                                <td class="px-6 py-3 text-right text-xl text-green-600 font-extrabold">1651.69</td>
                            </tr>
                            <tr class="border-b-2 border-gray-300 bg-blue-100 hover:bg-blue-200">
                                <td class="px-3 py-3 font-bold text-center w-10 text-2xl text-blue-600">5</td>
                                <td class="px-6 py-3 font-bold">Humidity</td>
                                <td class="px-6 py-3 text-right text-xl text-blue-600 font-extrabold">1588.09</td>
                            </tr>
                            <tr class="border-b-2 border-gray-300 bg-indigo-100 hover:bg-indigo-200">
                                <td class="px-3 py-3 text-center w-10 text-2xl text-indigo-600 font-extrabold">6</td>
                                <td class="px-6 py-3 font-bold">Speed</td>
                                <td class="px-6 py-3 text-right text-xl text-indigo-600 font-extrabold">765.86</td>
                            </tr>
                            <tr class="bg-purple-100 hover:bg-purple-200">
                                <td class="px-3 py-3 text-center w-10 text-2xl text-purple-600 font-extrabold">7</td>
                                <td class="px-6 py-3 font-bold">Pressure</td>
                                <td class="px-6 py-3 text-right text-xl text-purple-600 font-extrabold">523.79</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
            </div>
            
            <!-- COLUMN 2: Results, Analysis, and MODEL PERFORMANCE -->
            <div class="flex flex-col gap-8">

                <!-- 3. Result & AI Analysis Card: Original Content -->
                <section class="comic-card p-6 ring-4 ring-[#87CEEB] ring-offset-4 ring-offset-blue-50">
                    <!-- Prediction Result -->
                    <div class="mb-4 pb-4 border-b-2 border-gray-300">
                        <div class="text-xl font-bold text-gray-600">Predicted Global Horizontal Irradiance (GHI)</div>
                        <!-- Default text color set to vibrant pink -->
                        <div id="prediction-value" class="text-7xl font-extrabold text-[#FF6384] mt-2">‚Äî W/m¬≤</div>
                        <div id="prediction-meta" class="text-sm text-gray-500 mt-2">Submit inputs to get started.</div>
                    </div>
                    
                    <!-- AI Smart Analysis Section: Original Content -->
                    <div class="analysis-container p-4 rounded-xl border-4 border-[#00BFFF] bg-white text-gray-800 min-h-32 shadow-2xl" id="analysis-container" style="display:none; box-shadow: 4px 4px 0px #00BFFF;">
                        <!-- Header color changed to light blue for contrast -->
                        <div class="flex items-center gap-2 mb-3 text-blue-600 font-extrabold border-b border-gray-300 pb-1">
                            <span class="text-3xl">ü§ñ</span>
                            <span class="text-xl">Smart Operational Analysis</span>
                        </div>
                        
                        <div id="analysis-text" class="text-base text-gray-700 leading-relaxed">
                            <div class="dot-pulse">
                                <span>Analyzing conditions</span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                            </div>
                        </div>
                        
                        <p class="text-xs text-gray-500 mt-4 flex items-start gap-1">
                            <span>‚ìò Recommendation derived from meteorological heuristic patterns.</span>
                        </p>
                    </div>
                </section>
                
                <!-- 2. Model Performance Card: Original Content -->
                <section class="comic-card p-6 min-h-60">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-gray-300 pb-2">üìä Model Performance</h2>
                    <p class="text-base text-gray-600 mb-4">
                        Dataset: 32,686 meteorological observations (4 months). <br>Train/Test split: 26,148 / 6,538 samples.
                    </p>
                    <div class="flex flex-col space-y-4">
                        <!-- Metric boxes adjusted for cartoon theme -->
                        <div class="flex justify-between items-center p-4 rounded-xl bg-lime-200 border-l-8 border-lime-500 shadow-md">
                            <span class="font-extrabold text-lime-800 text-lg">R¬≤ Score (Goodness of Fit)</span>
                            <span class="text-2xl font-extrabold text-lime-900">0.93</span>
                        </div>
                        <div class="flex justify-between items-center p-4 rounded-xl bg-purple-200 border-l-8 border-purple-500 shadow-md">
                            <span class="font-extrabold text-purple-800 text-lg">MAE (Error Magnitude)</span>
                            <span class="text-2xl font-extrabold text-purple-900">33.19</span>
                        </div>
                        <div class="flex justify-between items-center p-4 rounded-xl bg-rose-200 border-l-8 border-rose-500 shadow-md">
                            <span class="font-extrabold text-rose-800 text-lg">RMSE (Outlier Sensitivity)</span>
                            <span class="text-2xl font-extrabold text-rose-900">82.99</span>
                        </div>
                    </div>
                </section>
            </div>
            
        </main>
    </div>

    <script>
        // NOTE: The API_BASE_URL is assumed to be running locally as per the original prompt.
        const API_BASE_URL = 'https://sungrid.onrender.com';

        
        const form = document.getElementById('predict-form');
        const predictionValueEl = document.getElementById('prediction-value');
        const predictionMetaEl = document.getElementById('prediction-meta');
        const analysisContainer = document.getElementById('analysis-container');
        const analysisText = document.getElementById('analysis-text');
        
        // Function to simulate exponential backoff for a more realistic fetch
        async function fetchWithBackoff(url, options, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    if (i === retries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    // console.log(`Retry ${i + 1}/${retries}. Waiting ${delay.toFixed(0)}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        form.addEventListener('submit', async (ev) => {
            ev.preventDefault();

            // Client-side validation for non-negative values
            const inputs = {
                Temperature: parseFloat(document.getElementById('temperature').value),
                Pressure: parseFloat(document.getElementById('pressure').value),
                Humidity: parseFloat(document.getElementById('humidity').value),
                WindDirection: parseFloat(document.getElementById('windDirection').value),
                Speed: parseFloat(document.getElementById('windSpeed').value),
            };

            for (const [key, value] of Object.entries(inputs)) {
                if (value < 0 && key !== 'Temperature') {
                    // Custom message box error instead of alert
                    predictionMetaEl.textContent = `‚ùå ERROR: ${key} cannot be negative. Try again!`;
                    return;
                }
            }
            
            // Auto-calculate time features
            const now = new Date();
            const payload = {
                ...inputs,
                Month: now.getMonth() + 1,
                Day: now.getDate(),
                Hour: now.getHours(),
                Minute: now.getMinutes(),
                Second: now.getSeconds(),
                // Placeholder sunrise/sunset times (as per original data structure)
                risehour: 6,
                riseminute: 0,
                sethour: 20,
                setminute: 0
            };

            // Set Loading States
            predictionValueEl.textContent = '...';
            predictionMetaEl.textContent = 'Sending super-secret data to the forecast machine...';
            analysisContainer.style.display = 'block';
            
            // Set analysis text to the loading animation
            analysisText.className = 'text-base text-gray-700 leading-relaxed'; 
            analysisText.innerHTML = `<div class="dot-pulse"><span>Analyzing conditions</span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;


            try {
                const data = await fetchWithBackoff(`${API_BASE_URL}/predict`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                // Simulate a fast result with a minimum display time
                await new Promise(r => setTimeout(r, 500)); 

                if (data.status === 'success' && typeof data.prediction === 'number') {
                    // Update prediction value
                    const prediction = Math.max(0, data.prediction); // Ensure prediction is non-negative
                    const roundedPrediction = prediction.toFixed(2);
                    predictionValueEl.textContent = `${roundedPrediction} W/m¬≤`;
                    
                    // Dynamic color update based on prediction intensity (using cartoon colors)
                    let resultColorClass;
                    if (prediction > 800) {
                        resultColorClass = 'text-green-600'; // High Power - Green
                    } else if (prediction > 400) {
                        resultColorClass = 'text-orange-600'; // Medium Power - Orange
                    } else {
                        resultColorClass = 'text-blue-600'; // Low Power - Blue
                    }
                    predictionValueEl.className = `text-7xl font-extrabold mt-2 ${resultColorClass}`;
                    
                    predictionMetaEl.textContent = `‚ö° Updated: ${new Date().toLocaleTimeString()}`;
                    
                    // Update AI analysis
                    analysisText.innerHTML = data.ai_analysis;
                } else {
                    predictionValueEl.textContent = 'WHOOPS!';
                    predictionValueEl.className = 'text-7xl font-extrabold text-red-600 mt-2';
                    predictionMetaEl.textContent = `Uh oh! The forecast machine broke: ${data.error || 'Unknown error.'}`;
                    analysisText.textContent = 'The model needs more sunshine data to make a tip!';
                }
            } catch (err) {
                predictionValueEl.textContent = 'WHOOPS!';
                predictionValueEl.className = 'text-7xl font-extrabold text-red-600 mt-2';
                predictionMetaEl.textContent = 'A big network cloud is blocking the signal! Check the API.';
                analysisText.textContent = 'Cannot connect to the analysis service! Is the server on?';
                console.error("API Call Error:", err);
            }
        });
    </script>
</body>
</html>